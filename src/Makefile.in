INSTALL= @INSTALL@
ROSEROOT = @ROSE_DIR@
XEROOT = @XERCESC_DIR@
XAROOT = @XALANC_DIR@
CXXFLAGS= -g -Wall -Wno-deprecated -I../include
CXXFLAGS += -I../include @ROSE_CFLAGS@ @XALANC_CFLAGS@ @XERCESC_CFLAGS@
LIBS  += -L. -lxevxml @ROSE_LIBS@ @XALANC_LIBS@ @XERCESC_LIBS@


BINDIR=@BINDIR@
LIBDIR=@LIBDIR@
INCDIR=@INCDIR@/xevxml

SRCS    =  xmlutils.cpp type.cpp rose2xml.cpp xml2rose.cpp \
	preproc.cpp unparse.cpp expr.cpp stmt.cpp decl.cpp supp.cpp value.cpp
OBJS = ${SRCS:.cpp=.o}
DEPS = ${SRCS:.cpp=.d}

# static link library for ease of debugging
LIBTARGET = libxevxml.a
TARGET =  src2xml xsltexec xml2src #dir2xml

.SUFFIXES: .cpp .o

all : $(TARGET)

$(LIBTARGET): $(OBJS)
	ar crv $(LIBTARGET) $(OBJS)
src2xml: $(LIBTARGET)
	$(CXX) $(CXXFLAGS) src2xml.cpp -o $@ $(LIBS)

xsltexec: $(LIBTARGET)
	$(CXX) $(CXXFLAGS) xslt.cpp -o $@ $(LIBS)

xml2src: $(LIBTARGET)
	$(CXX) $(CXXFLAGS) xml2src.cpp -o $@ $(LIBS)

#dir2xml: $(LIBTARGET)
#	$(CXX) $(CXXFLAGS) dir2xml.o -o $@ $(LIBS)

.cpp.o:
	$(CXX) $(CXXFLAGS) -o $@ -c $^

-include $(DEPS)

clean:
	-@rm -fr *~ $(OBJS) src2xml.o xslt.o xml2src.o dir2xml.o $(DEPS) $(TARGET) $(LIBTARGET) rose_* a.out
install:
	$(INSTALL) -m 775 -d $(BINDIR)
	$(INSTALL) -m 775 -d $(INCDIR)
	$(INSTALL) -m 775 -d $(LIBDIR)
	$(INSTALL) -m 755 $(TARGET) $(BINDIR)
	$(INSTALL) -m 644 ../include/*.hpp $(INCDIR)
	$(INSTALL) -m 644 $(LIBTARGET) $(LIBDIR)
