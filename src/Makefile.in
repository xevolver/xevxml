LD = $(CXX)

ROSEROOT = @ROSE_DIR@
XEROOT = @XERCESC_DIR@
XAROOT = @XALANC_DIR@
CXXFLAGS= -g -Wall -Wno-deprecated -I../include
CXXFLAGS += -I../include @ROSE_CFLAGS@ @XALANC_CFLAGS@ @XERCESC_CFLAGS@
LIBS  += -L. -lxevxml @ROSE_LIBS@ @XALANC_LIBS@ @XERCESC_LIBS@

SRCS    =  xmlutils.cpp type.cpp rose2xml.cpp xml2rose.cpp \
	preproc.cpp unparse.cpp expr.cpp stmt.cpp decl.cpp supp.cpp value.cpp
OBJS = ${SRCS:.cpp=.o}
DEPS = ${SRCS:.cpp=.d}

# static link library for ease of debugging
LIBTARGET = libxevxml.a
TARGET =  $(LIBTARGET) src2xml xsltexec xml2src dir2xml

.SUFFIXES: .cpp .o

all : $(TARGET)

$(LIBTARGET): $(OBJS)
	ar crv $(LIBTARGET) $(OBJS)
src2xml: libxevxml.a
	$(CXX) $(CXXFLAGS) src2xml.cpp -o $@ $(LIBS)

xsltexec: libxevxml.a
	$(CXX) $(CXXFLAGS) xslt.cpp -o $@ $(LIBS)

xml2src: libxevxml.a
	$(CXX) $(CXXFLAGS) xml2src.cpp -o $@ $(LIBS)

dir2xml: libxevxml.a
	$(CXX) $(CXXFLAGS) dir2xml.cpp -o $@ $(LIBS)

.cpp.o:
	$(CXX) $(CXXFLAGS) -o $@ -c $^

-include $(DEPS)

clean:
	-@rm -fr *~ $(OBJS) src2xml.o xslt.o xml2src.o dir2xml.o $(DEPS) $(TARGET) rose_* a.out
